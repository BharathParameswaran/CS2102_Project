<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel = "stylesheet" type="text/css" href="css/lib/bootstrap.css">
<link rel = "stylesheet" type="text/css" href="css/lib/jquery-ui.css">
<script src="js/lib/jquery-2.1.0.js"></script>
<script src = "js/lib/jquery-ui.js"></script>
<script>
	var roomTypeData="";
	var userId = -1;
	function refreshTable() {
		userId = 2;

		url = "php/editBooking.php?userId=" + userId + "&bookingId=0" + "&action=getRoomType";
		jQuery.getJSON(url, function (data) {
			for (i = 0; i < data.length; i++) {
				roomTypeData += "<option value=\"" + data[i].cId + "\">" + data[i].cname + "</option>";
			}
	     });

		url = "php/editBooking.php?userId=" + userId + "&bookingId=0" + "&action=getInitialDate";
		jQuery.getJSON(url, function (data) {
			updateTable(data);
         });
	}

	function getTypeSelect(id) {
			roomSelectString = "<select id=\"romeType" + id + "\">" + roomTypeData + "</select>";
			return roomSelectString;
	}

	function updateTable(data) {
		$('#pendingBookingTable tbody').remove();
		$('#pastBookingTable tbody').remove();
		for (i = 0; i < data.length; i++) {
			today = new Date();
			checkInDate = new Date(data[i].checkInDate);
			if (checkInDate >= today && data[i].status == "confirmed") {
				$('#pendingBookingTable').append('<tr><td>' + data[i].hName + '</td><td>' + data[i].roomCat + '</td><td>' + data[i].bookingDate + '</td><td>' + data[i].checkInDate + '</td><td>' + data[i].duration + '</td><td>' + data[i].guests + '</td><td>' + data[i].status + '</td><td><input type="button" id="updateButton' + data[i].bId + '" onclick="alterTable(' + data[i].bId + ')" value="Update"/><td><button onclick="cancelBooking(' + data[i].bId + ')">Cancel</button></td>');

				$('#pendingBookingTable').append('<tr id="row' + data[i].bId + '" style="display: none"><td></td><td>' + "<select id=\"roomType" + data[i].bId + "\">" + roomTypeData + "</select>" + '</td><td></td><td><input type="text" class="form-control" id="datepicker' + data[i].bId + '"" value="' + data[i].checkInDate + '"  size="10">' + '</td><td><input type="text" id="duration' + data[i].bId + '" value="' + data[i].duration + '" size="4"></td><td></td><td></td><td><button onclick="updateBooking(' + data[i].bId + ', ' + data[i].roomCatId + ')">Confirm</button></td><td></td>');

				$("#datepicker" + data[i].bId).datepicker({
			       	dateFormat: "yy-mm-dd"
			    });
			    document.getElementById('roomType' + data[i].bId).value = data[i].roomCatId;
			} else {
				$('#pastBookingTable').append('<tr><td>' + data[i].hName + '</td><td>' + data[i].roomCat + '</td><td>' + data[i].bookingDate + '</td><td>' + data[i].checkInDate + '</td><td>' + data[i].duration + '</td><td>' + data[i].guests + '</td><td>' + data[i].status + '</td>');
			}
		}
	}

	function cancelBooking(id) {
		var r = confirm("Are you sure you want to cancel the booking?");
		if (r == true) {
		url = "php/editBooking.php?userId=" + userId + "&bookingId=" + id + "&action=cancel";
		jQuery.getJSON(url, function (data) {
			updateTable(data);
         });
		} 
	}

	function alterTable(id) {
		if ( document.getElementById("updateButton" + id).value == "Update") {
			document.getElementById("row" + id).style.display = "";
			document.getElementById("updateButton" + id).value = "Hide";
		} else {
			document.getElementById("row" + id).style.display = "none";
			document.getElementById("updateButton" + id).value = "Update";
		}
	} 

	function updateBooking(id, originalRoomCat) {
		var r = confirm("Are you sure you want to update the booking?");
		if (r == true) {
			url = "";
			if (originalRoomCat != document.getElementById("roomType" + id).value) {
				url = "php/editBooking.php?userId=" + userId + "&bookingId=" + id + "&action=edit&checkInDate=" + document.getElementById("datepicker" + id).value + "&duration=" + document.getElementById("duration" + id).value + "&roomType=" + document.getElementById("roomType" + id).value ;
			} else {
				url = "php/editBooking.php?userId=" + userId + "&bookingId=" + id + "&action=edit&checkInDate=" + document.getElementById("datepicker" + id).value + "&duration=" + document.getElementById("duration" + id).value + "&roomType=-1";
			}
		jQuery.getJSON(url, function (data) {
			updateTable(data);
         });
		} 

	}

</script>
</head>
<body onload="refreshTable()">
	<div class="row">
  		<div class="col-md-12"><h2 class="bg-primary"><p class="text-left">HotelBooking</p></h2></div>
	</div>


	<div class="row">
		<div class="col-md-1"></div>
		<div class="col-md-10"><b><p class="text-left">Pending Booking</p></b></div>
	<div class="col-md-1"></div>
	</div>

	<div class="row">
		<div class="col-md-1"></div>
		<div class="col-md-10">
			<table class="table table-striped table-bordered" id="pendingBookingTable">
		         <thead>
		           <tr>
		             <th>Hotel Name</th>
		             <th width="220">Room Type</th>
		             <th>Booking Date</th>
		             <th width="150">Check In Date</th>
		             <th>Duration</th>
		             <th>Number of Guests</th>
		             <th>Status</th>
		             <th></th>
		             <th></th>
		           </tr>
		         </thead>
		         <tbody>
		         </tbody>
		    </table>
		</div>
	<div class="col-md-1"></div>
	</div>

	<div class="row">
		<div class="col-md-1"></div>
		<div class="col-md-10"><b><p class="text-left">Past Booking</p></b></div>
	<div class="col-md-1"></div>
	</div>

	<div class="row">
		<div class="col-md-1"></div>
		<div class="col-md-10">
			<table class="table table-striped table-bordered" id="pastBookingTable">
		         <thead>
		           <tr>
		             <th>Hotel Name</th>
		             <th>Room</th>
		             <th>Booking Date</th>
		             <th>Check In Date</th>
		             <th>Duration</th>
		             <th>Number of Guests</th>
		             <th>Status</th>
		           </tr>
		         </thead>
		         <tbody>
		         </tbody>
		    </table>
		</div>
	<div class="col-md-1"></div>
	</div>

	<div id="testDiv"></div>

 </body>
</html>